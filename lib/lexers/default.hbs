{{#if functionDef}}
function lexer(input) {
{{/if}}

var currentState = {{initialState}}
{{#if initialStateIsAccepted}}
  , isMatched = true
{{else}}
  , isMatched = false
{{/if}}
  , i = 0
  , ii = input.length
  , lastMatch = 0
  , results = []
  , transitions = [

    {{#each transitions}}

      {{#if @first}}
      function () {
      {{else}}
    , function () {
      {{/if}}
        {{#if manyTransitions}}
{{>manyTransitionsPartial}}
        {{/if}}
        {{#if oneTransition}}
{{>oneTransitionPartial}}
        {{/if}}
        {{#if noTransitions}}
{{>noTransitionsPartial}}
        {{/if}}
      }

    {{/each}}

    ]

    for (;i<ii;++i) {
      transitions[currentState]()
    }

    if (isMatched) {
      results.push(input.slice(lastMatch))
    }

    return results

{{#if functionDef}}
}
{{/if}}
